version: v1.0
name: Dockerâ€‘Compose CI
agent:
  machine:
    type: f1-standard-2
    os_image: ubuntu2004
global_job_config:
  secrets:
    - name: ENV_FILE
  prologue:
    commands:
      - checkout
      - ls
      - cp /home/semaphore/ENV_FILE/.env ./.env
      - mkdir -p website
      - cp /home/semaphore/ENV_FILE/website/.env website/.env
blocks:
  - name: Run tests in Docker Compose
    task:
      jobs:
        - name: ' integration tests'
          commands:
            - 'docker compose up '
      secrets:
        - name: ENV_FILE
        - name: ENV_FILE_Secret
      epilogue:
        always:
          commands:
            - echo "starting the tests"
        on_fail:
          commands:
            - echo "the job failed"
      prologue:
        commands:
          - echo "prologue"
