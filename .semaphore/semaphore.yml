# .semaphore/semaphore.yml
# → version must be v1.0       :contentReference[oaicite:0]{index=0}
version: v1.0

# give your pipeline a friendly name
name: Docker‑Compose CI

# use a standard Linux VM with Docker pre‑installed :contentReference[oaicite:1]{index=1}
agent:
  machine:
    type: e1‐standard‐2
    os_image: ubuntu2004

# attach these secrets (files) to every job in the pipeline
global_job_config:
  secrets:
    - name: root‑env‑file
    - name: website‑env‑file

# a single block that runs your tests
blocks:
  - name: Run tests in Docker Compose
    task:
      jobs:
        - name: up & test
          commands:
            # clone your repo
            - checkout

            # bring up all services, abort on first container exit,
            # and return the exit code of the `test` service
            - docker-compose up --abort-on-container-exit --exit-code-from test

